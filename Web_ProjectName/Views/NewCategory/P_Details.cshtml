@{
    ViewData["Title"] = "Chi tiết danh mục tin tức";
    ViewData["Description"] = "Xem chi tiết thông tin danh mục tin tức";
    Layout = "_LayoutDashmin";
}

<!-- Content Start -->
<div class="container-fluid pt-4 px-4">
    <div class="row g-4">
        <div class="col-12">
            <div class="bg-light rounded h-100 p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h6 class="mb-0">Chi tiết danh mục tin tức</h6>
                    <div>
                        <a href="/new-category" class="btn btn-outline-secondary me-2">
                            <i class="fa fa-arrow-left me-2"></i>Quay lại
                        </a>
                        <button type="button" class="btn btn-primary" onclick="editCategory()">
                            <i class="fa fa-edit me-2"></i>Chỉnh sửa
                        </button>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Thông tin danh mục</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">ID:</label>
                                            <p class="mb-0" id="categoryId">-</p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Tên danh mục:</label>
                                            <p class="mb-0" id="categoryName">-</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Trạng thái:</label>
                                            <p class="mb-0" id="categoryStatus">-</p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">URL Meta:</label>
                                            <p class="mb-0" id="categoryMetaUrl">-</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Ngày tạo:</label>
                                            <p class="mb-0" id="categoryCreatedAt">-</p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Cập nhật lần cuối:</label>
                                            <p class="mb-0" id="categoryUpdatedAt">-</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Thống kê</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Số tin tức:</span>
                                        <span class="badge bg-primary" id="newsCount">0</span>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Lượt xem:</span>
                                        <span class="badge bg-info" id="viewCount">0</span>
                                    </div>
                                </div>
                                <hr>
                                <div class="alert alert-info">
                                    <i class="fa fa-info-circle me-2"></i>
                                    <small>Thống kê sẽ được cập nhật theo thời gian thực</small>
                                </div>
                            </div>
                        </div>

                        <div class="card mt-3">
                            <div class="card-header">
                                <h6 class="mb-0">Thao tác</h6>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button type="button" class="btn btn-outline-primary" onclick="editCategory()">
                                        <i class="fa fa-edit me-2"></i>Chỉnh sửa
                                    </button>
                                    <button type="button" class="btn btn-outline-danger" onclick="deleteCategory()">
                                        <i class="fa fa-trash me-2"></i>Xóa danh mục
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent News Section -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Tin tức gần đây trong danh mục</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Tiêu đề</th>
                                                <th>Ngày đăng</th>
                                                <th>Lượt xem</th>
                                                <th>Trạng thái</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentNewsTable">
                                            <tr>
                                                <td colspan="4" class="text-center">Đang tải...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Content End -->

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteCategoryModal" tabindex="-1" aria-labelledby="deleteCategoryModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteCategoryModalLabel">Xác nhận xóa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xóa danh mục <strong id="deleteCategoryName"></strong> không?</p>
                <p class="text-danger"><strong>Hành động này không thể hoàn tác!</strong></p>
                <div class="alert alert-warning">
                    <i class="fa fa-exclamation-triangle me-2"></i>
                    <small>Tất cả tin tức trong danh mục này sẽ bị ảnh hưởng</small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger" onclick="confirmDelete()">Xóa</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        let categoryId = null;
        let categoryData = null;

        $(document).ready(function () {
            // Get category ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            categoryId = urlParams.get('id');

            if (!categoryId) {
                showAlert('Không tìm thấy ID danh mục', 'error');
                setTimeout(() => {
                    window.location.href = '/new-category';
                }, 2000);
                return;
            }

            // Load category data
            loadCategoryData();
        });

        function loadCategoryData() {
            $.ajax({
                url: `/NewCategory/GetById?id=${categoryId}`,
                type: 'GET',
                success: function (response) {
                    if (response.result === 1) {
                        categoryData = response.data;
                        populateCategoryDetails();
                        loadRecentNews();
                    } else {
                        showAlert('Không tìm thấy danh mục', 'error');
                        setTimeout(() => {
                            window.location.href = '/new-category';
                        }, 2000);
                    }
                },
                error: function () {
                    showAlert('Lỗi kết nối', 'error');
                }
            });
        }

        function populateCategoryDetails() {
            if (!categoryData) return;

            $('#categoryId').text(categoryData.id);
            $('#categoryName').text(categoryData.name);
            $('#categoryMetaUrl').text(categoryData.metaUrl || 'Không có');

            const statusText = categoryData.status === 1 ? 'Hoạt động' : 'Không hoạt động';
            const statusClass = categoryData.status === 1 ? 'text-success' : 'text-secondary';
            $('#categoryStatus').html(`<span class="${statusClass}">${statusText}</span>`);

            $('#categoryCreatedAt').text(new Date(categoryData.createdAt).toLocaleDateString('vi-VN'));
            $('#categoryUpdatedAt').text(new Date(categoryData.updatedAt).toLocaleDateString('vi-VN'));
        }

        function loadRecentNews() {
            // This would typically load news from the same category
            // For now, we'll show a placeholder
            $('#recentNewsTable').html(`
                                <tr>
                                    <td colspan="4" class="text-center">Chưa có tin tức nào trong danh mục này</td>
                                </tr>
                            `);
        }

        function editCategory() {
            if (categoryId) {
                window.location.href = `/new-category/edit?id=${categoryId}`;
            }
        }

        function deleteCategory() {
            if (categoryData) {
                $('#deleteCategoryName').text(categoryData.name);
                $('#deleteCategoryModal').modal('show');
            }
        }

        function confirmDelete() {
            if (!categoryId) return;

            $.ajax({
                url: `/new-category/delete?id=${categoryId}`,
                type: 'DELETE',
                success: function (response) {
                    if (response.result === 1) {
                        showAlert('Xóa danh mục thành công', 'success');
                        $('#deleteCategoryModal').modal('hide');
                        setTimeout(() => {
                            window.location.href = '/new-category';
                        }, 1500);
                    } else {
                        showAlert(response.error || 'Lỗi khi xóa danh mục', 'error');
                    }
                },
                error: function () {
                    showAlert('Lỗi kết nối', 'error');
                }
            });
        }

        function showAlert(message, type) {
            const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
            const alertHtml = `
                                <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                                    ${message}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            `;

            // Remove existing alerts
            $('.alert').remove();

            // Add new alert
            $('.container-fluid').prepend(alertHtml);

            // Auto hide after 3 seconds
            setTimeout(() => {
                $('.alert').fadeOut();
            }, 3000);
        }
    </script>
}